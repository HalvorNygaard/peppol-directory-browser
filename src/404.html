<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>404 - Peppol Directory</title>
    <script>
      // GitHub Pages (and other static hosts) serve this file for unknown
      // paths. We want the SPA to handle client-side routes like
      // /directory/:id. This script attempts to fetch the SPA's `index.html`
      // from a few likely locations (repository base, site root, origin)
      // and writes it into the document while preserving the requested
      // URL so the router initializes the correct view. If all attempts
      // fail we fall back to a redirect to the app base.
      (function () {
        var reqPath = location.pathname + location.search + location.hash;
        var candidates = [
          // GitHub Pages repo subpath
          '/peppol-directory-browser/index.html',
          // site root
          '/index.html',
          // origin root
          location.origin + '/index.html'
        ];

        function tryFetch(list) {
          if (!list || list.length === 0) return Promise.reject();
          var url = list[0];
          return fetch(url, { credentials: 'omit' }).then(function (r) {
            if (!r.ok) throw new Error('fetch failed');
            return r.text().then(function (html) {
              document.open();
              document.write(html);
              document.close();
              // Ensure the router sees the original requested path
              try { history.replaceState(null, '', reqPath); } catch (e) {}
            });
          }).catch(function () {
            return tryFetch(list.slice(1));
          });
        }

        tryFetch(candidates).catch(function () {
          // As a last resort, navigate to the app base so users can still use the site.
          location.replace('/peppol-directory-browser/');
        });
      })();
    </script>
  </head>
  <body>
    Loading...
  </body>
  </html>
