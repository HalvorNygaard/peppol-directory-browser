<div class="container">
  <div class="header">
      <div class="header-left">
        <button *ngIf="selectedMatch" class="back-button header-back" (click)="backToList()">←</button>
        <div class="header-title-wrap">
          <h1 class="header-title">{{ selectedMatch ? getCompanyName(selectedMatch) : TEXT.APP_TITLE }}</h1>
          <div *ngIf="selectedMatch" class="header-subtitle muted">{{ getCompanyLabel(selectedMatch) }}</div>
        </div>
      </div>
    <div class="header-right"></div>
    <!-- header action removed: using Enter to search, logo button not needed -->
  </div>
  
  <!-- Search Form -->
  <div class="search-form" *ngIf="!selectedMatch">
    <div class="form-group search-group">
      <input 
        class="search-input"
        type="text" 
        id="searchQuery" 
        [(ngModel)]="searchQuery" 
        (keyup.enter)="search()"
        placeholder="search..">
    </div>

    <div class="form-group country-group">
      <div class="country-filter-container">
        <select 
          id="countryFilter" 
          class="country-select"
          [(ngModel)]="countryFilter"
          (change)="search()">
          <option value="">{{ TEXT.ALL_COUNTRIES }}</option>
          <optgroup label="Europe">
            <option *ngFor="let c of europeCountries" [value]="c.code">{{ c.name }}</option>
          </optgroup>
          <option disabled>────────────</option>
          <optgroup label="Rest of world">
            <option *ngFor="let c of otherCountries" [value]="c.code">{{ c.name }}</option>
          </optgroup>
        </select>
        <!-- clear filter button removed per UX preference -->
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="results-list" *ngIf="searchPerformed && !selectedMatch">
    <!-- results header removed (counts shown at bottom) -->
    
    <div class="match-cards" *ngIf="filteredMatches.length > 0">
          <div 
            class="match-card" 
            *ngFor="let match of filteredMatches"
            (click)="selectMatch(match)">
            <div class="card-title">{{ getCompanyName(match) }}</div>
            <div class="card-subtitle">
              <span class="country-info">
                <img [src]="getFlagUrl(getCountryCode(match))" [alt]="getCountryCode(match) + ' flag'" class="country-flag">
                {{ getCountryName(getCountryCode(match)) }}
              </span>
            </div>
            <div class="card-meta">
              <div>{{ getCompanyLabel(match) }}</div>
            </div>
          </div>
    </div>
    
  <!-- Pagination -->
  <div class="pagination-container" *ngIf="result && filteredMatches.length > 0">
      <div class="pagination-bar">
        <div class="page-size-selector">
          <label for="pageSize">{{ TEXT.RESULTS_PER_PAGE }}</label>
          <select 
            id="pageSize" 
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange()">
            <option *ngFor="let s of pageSizes" [value]="s">{{ s }}</option>
          </select>
        </div>

        <div class="pagination">
          <button
            class="page-btn"
            [disabled]="currentPage === 0"
            (click)="goToPage(0)"
            aria-label="First page"
            title="First">
            <svg viewBox="0 0 12 12" aria-hidden="true" focusable="false">
              <rect x="1.5" y="2" width="1" height="8" fill="currentColor"></rect>
              <path d="M9 2 L5 6 L9 10 Z" fill="currentColor"></path>
            </svg>
          </button>
          <button 
            class="page-btn" 
            [disabled]="currentPage === 0"
            (click)="goToPage(currentPage - 1)"
            aria-label="Previous page"
            title="Previous">
            <svg viewBox="0 0 12 12" aria-hidden="true" focusable="false">
              <path d="M8 2 L4 6 L8 10 Z" fill="currentColor"></path>
            </svg>
          </button>
          <ng-container *ngIf="getPaginationPages().length > 0">
            <div class="page-numbers">
              <button 
                *ngFor="let page of getPaginationPages()"
                class="page-btn"
                [class.active]="page === currentPage"
                (click)="goToPage(page)">
                {{ page + 1 }}
              </button>
            </div>
          </ng-container>

          <button 
            class="page-btn icon"
            [disabled]="currentPage >= getTotalPages() - 1"
            (click)="goToPage(currentPage + 1)"
            aria-label="Next page"
            title="Next">
            <svg viewBox="0 0 12 12" aria-hidden="true" focusable="false">
              <path d="M4 2 L8 6 L4 10 Z" fill="currentColor"></path>
            </svg>
          </button>
          <button
            class="page-btn icon"
            [disabled]="currentPage >= getTotalPages() - 1"
            (click)="goToPage(getTotalPages() - 1)"
            aria-label="Last page"
            title="Last">
            <svg viewBox="0 0 12 12" aria-hidden="true" focusable="false">
              <path d="M3 2 L7 6 L3 10 Z" fill="currentColor"></path>
              <rect x="9" y="2" width="1" height="8" fill="currentColor"></rect>
            </svg>
          </button>
        </div>

        <div class="results-info" *ngIf="result">
          <p>{{ (result['first-result-index'] ?? 0) + 1 }}-{{ (result['last-result-index'] ?? 0) + 1 }} of {{ result['total-result-count'] ?? 0 }} results</p>
          <div *ngIf="(result['total-result-count'] ?? 0) > MAX_RETURNABLE_RESULTS && currentPage >= getTotalPages() - 1" class="muted small">Note: displaying first {{ MAX_RETURNABLE_RESULTS }} results (server limit).</div>
        </div>
        <!-- paging debug removed for production build -->
      </div>
    </div>

    <div class="no-results" *ngIf="!isLoading && searchPerformed && ((searchQuery && searchQuery.trim().length > 0) || countryFilter) && filteredMatches.length === 0">
      <p>{{ TEXT.NO_RESULTS }}</p>
      <p *ngIf="countryFilter" class="filter-suggestion">
        Try removing the country filter or searching with different terms.
      </p>
    </div>
  </div>



  <!-- Details View -->
  <app-details *ngIf="selectedMatch" [match]="selectedMatch" (back)="backToList()"></app-details>
</div>